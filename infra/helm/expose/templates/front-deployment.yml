apiVersion: apps/v1
kind: Deployment
metadata:
  name: phraseanet-service-expose-front
spec:
  replicas: 1
  selector:
    matchLabels:
      app: phraseanet-service
      tier: expose-front
  template:
    metadata:
      labels:
        app: phraseanet-service
        tier: expose-front
    spec:
      volumes:
      - name: configs
        configMap:
          name: {{ .Values.volumes.configs.configmap_name }}
      containers:
      - name: expose-front
        image: {{ .Values.repository.baseurl }}/ps-expose-front:{{ .Values.repository.tag }}
        terminationMessagePolicy: FallbackToLogsOnError
        volumeMounts:
        - name: configs
          mountPath: "/configs"
        env:
        - name: DEV_MODE
          value: "False"
        - name: EXPOSE_BASE_URL
          value: "{{ .Values.params.expose_base_url }}"
        - name: AUTH_BASE_URL
          value: "{{ .Values.params.auth_base_url }}"
        {{- if not .Values.oauth.use_secret }}
        - name: CLIENT_ID
          value: "{{ .Values.oauth.client_id }}"
        - name: CLIENT_SECRET
          value: "{{ .Values.oauth.client_secret }}"
        {{- end }}
        - name: MATOMO_HOST
          value: "{{ .Values.params.matomo_host }}"
        {{- if .Values.oauth.use_secret }}
        - name: CLIENT_ID
          valueFrom:
            secretKeyRef:
              name: {{ .Values.oauth.secret_name }}
              key: CONCAT
        - name: CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              name: {{ .Values.oauth.secret_name }}
              key: CLIENT_SECRET
        {{- end }}

