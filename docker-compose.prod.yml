version: '3.9'

services:
  uploader-client:
    profiles:
      - uploader
    image: ${REGISTRY_NAMESPACE}uploader-client:$DOCKER_TAG
    build:
      context: ./uploader/client
      target: uploader-client-nginx
    volumes:
      - ./configs:/configs
    networks:
      - internal
    environment:
      - DEV_MODE
      - UPLOADER_API_BASE_URL=https://api-uploader.${PHRASEA_DOMAIN}
      - AUTH_API_BASE_URL=https://api-auth.${PHRASEA_DOMAIN}
      - CLIENT_ID=${UPLOADER_CLIENT_ID}
      - CLIENT_RANDOM_ID=${UPLOADER_CLIENT_RANDOM_ID}
      - CLIENT_SECRET=${UPLOADER_CLIENT_SECRET}
      - DISPLAY_SERVICES_MENU
      - DASHBOARD_BASE_URL=https://dashboard.${PHRASEA_DOMAIN}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.uploader-client.rule=Host(`uploader.${PHRASEA_DOMAIN}`)"

  expose-client:
    profiles:
      - expose
    image: ${REGISTRY_NAMESPACE}expose-client:$DOCKER_TAG
    build:
      context: ./expose/client
      target: expose-client-nginx
    volumes:
      - ./configs:/configs
    networks:
      - internal
    environment:
      - EXPOSE_API_BASE_URL=https://api-expose.${PHRASEA_DOMAIN}
      - AUTH_API_BASE_URL=https://api-auth.${PHRASEA_DOMAIN}
      - CLIENT_ID=${EXPOSE_CLIENT_ID}
      - CLIENT_RANDOM_ID=${EXPOSE_CLIENT_RANDOM_ID}
      - CLIENT_SECRET=${EXPOSE_CLIENT_SECRET}
      - MATOMO_HOST
      - EXPOSE_REQUEST_SIGNATURE_TTL
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.expose-client.rule=Host(`expose.${PHRASEA_DOMAIN}`)"

  databox-client:
    profiles:
      - databox
    image: ${REGISTRY_NAMESPACE}databox-client:$DOCKER_TAG
    build:
      context: ./databox/client
      target: databox-client-nginx
    volumes:
      - ./configs:/configs
    networks:
      - internal
    environment:
      - DEV_MODE
      - DATABOX_API_BASE_URL=https://api-databox.${PHRASEA_DOMAIN}
      - DATABOX_REQUEST_SIGNATURE_TTL
      - AUTH_API_BASE_URL=https://api-auth.${PHRASEA_DOMAIN}
      - UPLOADER_API_BASE_URL=https://api-uploader.${PHRASEA_DOMAIN}
      - CLIENT_ID=${DATABOX_CLIENT_ID}
      - CLIENT_RANDOM_ID=${DATABOX_CLIENT_RANDOM_ID}
      - CLIENT_SECRET=${DATABOX_CLIENT_SECRET}
      - MATOMO_HOST
      - DISPLAY_SERVICES_MENU
      - DASHBOARD_BASE_URL=https://dashboard.${PHRASEA_DOMAIN}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.databox-client.rule=Host(`databox.${PHRASEA_DOMAIN}`)"
